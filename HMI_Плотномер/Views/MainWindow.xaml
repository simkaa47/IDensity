<Window x:Class="IDensity.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"               
        xmlns:vm="clr-namespace:IDensity.ViewModels"       
        xmlns:oxy="http://oxyplot.org/wpf" xmlns:col1="clr-namespace:System.Collections;assembly=System.Runtime.Extensions" xmlns:sys1="clr-namespace:System;assembly=System.Runtime"
        xmlns:wpftool="http://schemas.xceed.com/wpf/xaml/toolkit"
        xmlns:fa="http://schemas.fontawesome.io/icons/"
        xmlns:add="clr-namespace:IDensity.AddClasses"
        xmlns:i="clr-namespace:System.Windows.Interactivity;assembly=System.Windows.Interactivity"
        xmlns:uc="clr-namespace:IDensity.Views.Resourses.UserControls"       
        mc:Ignorable="d"        
        Title="MainWindow" Height="450" Width="800"
        Background="DarkSlateGray">
    <Window.DataContext>
        <vm:VM/>
    </Window.DataContext>
    
    <!--#region Страницы -->
    <Grid>
        <!--#region Верхний бар -->
        <Grid>
            <Grid.Resources>
                <Style TargetType="Border" BasedOn="{StaticResource BorderLight}"/>
                <Style TargetType="TextBlock" BasedOn="{StaticResource Common}"/>
            </Grid.Resources>
            <Grid.ColumnDefinitions>
                <ColumnDefinition></ColumnDefinition>
                <ColumnDefinition></ColumnDefinition>
                <ColumnDefinition></ColumnDefinition>
                <ColumnDefinition></ColumnDefinition>
                <ColumnDefinition></ColumnDefinition>
                <ColumnDefinition></ColumnDefinition>
                <ColumnDefinition Width="0.4*"></ColumnDefinition>
            </Grid.ColumnDefinitions>
            <!--#region Эмблема заказчика -->
            <Border Grid.Column="0" Margin="5">
                <TextBlock Text="Место для эмблемы заказчика" VerticalAlignment="Center" HorizontalAlignment="Center" TextWrapping="Wrap"></TextBlock>
            </Border>
            <!--#endregion-->
            <!--#region Серийный номер -->
            <Border Grid.Column="1"  Margin="5">
                <UniformGrid Rows="2">
                    <TextBlock Text="Серийный номер:" VerticalAlignment="Center" HorizontalAlignment="Center"></TextBlock>
                    <TextBlock Text="000000" VerticalAlignment="Center" HorizontalAlignment="Center"></TextBlock>
                </UniformGrid>
            </Border>
            <!--#endregion-->
            <!--#region Индикатор связи с платой -->
            <Border Background="{Binding mainModel.Connecting.Value, Converter={StaticResource ColorToBool}}"  Grid.Column="2" Margin="5">
                <TextBlock Text="Связь с платой" VerticalAlignment="Center" HorizontalAlignment="Center"></TextBlock>
            </Border>
            <!--#endregion-->
            <!--#region Индикатор измерений -->
            <Border Grid.Column="3" Margin="5" Background="{Binding mainModel.CycleMeasStatus.Value, Converter={StaticResource ColorToBool}}">               
                <TextBox Text="{Binding mainModel.CycleMeasStatus.Value, Converter={StaticResource StatusFromNum}, ConverterParameter={StaticResource measStatus}}"
                         TextWrapping="Wrap"
                         VerticalAlignment="Center"
                         HorizontalAlignment="Center"></TextBox>
            </Border>
            <!--#endregion-->
            <!--#region Индикатор высокого напряжения -->
            <Border Grid.Column="4" Margin="5" Background="{Binding mainModel.TelemetryHV.HvOn.Value, Converter={StaticResource ColorToBool}}">                
                <TextBox Text="{Binding mainModel.TelemetryHV.HvOn.Value, Converter={StaticResource StatusFromNum}, ConverterParameter={StaticResource hvStatus}}"
                         TextWrapping="Wrap"
                         VerticalAlignment="Center"
                         HorizontalAlignment="Center"
                         HorizontalContentAlignment="Center"></TextBox>
            </Border>
            <!--#endregion-->
            <!--#region Время и пользователь -->
            <Border Grid.Column="5" Margin="5">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition></RowDefinition>
                        <RowDefinition></RowDefinition>
                    </Grid.RowDefinitions>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition/>
                        <ColumnDefinition Width="0.2*"/>
                    </Grid.ColumnDefinitions>
                    <!--#region RTC -->
                    <Viewbox Grid.ColumnSpan="2"  >
                        <TextBlock Text="{Binding mainModel.Rtc.Value, StringFormat=F,   UpdateSourceTrigger=PropertyChanged, ConverterCulture=ru-RU,  Mode=OneWay}"/>
                    </Viewbox>
                    <!--#endregion-->
                    <!--#region Авторизация -->
                    <Button Grid.Row="1" Margin="2"  MouseDoubleClick="Logout_click" HorizontalContentAlignment="Stretch">
                        <Button.ToolTip>Авторизация</Button.ToolTip>
                        <StackPanel Orientation="Horizontal">
                            <fa:ImageAwesome Icon="User" HorizontalAlignment="Left" Margin="5,1,10,1"/>
                            <TextBlock Text="{Binding CurUser, Converter={StaticResource UserToName} }" VerticalAlignment="Center"  HorizontalAlignment="Stretch">
                            </TextBlock>
                        </StackPanel>
                    </Button>
                    <!--#endregion-->
                    <!--#region Логаут -->
                    <Button Grid.Column="1" Command="{Binding LogoutCommand}" Grid.Row="1" Margin="2">
                        <fa:ImageAwesome Icon="Reply"/>
                    </Button>
                    <!--#endregion-->
                </Grid>
            </Border>
            <!--#endregion-->
            <!--#region Кнопка закрыть приложение -->
            <Button Grid.Column="6" Margin="5" Command="{Binding CloseAppCommand}">
                <Button.ToolTip>Закрыть приложение</Button.ToolTip>
                <fa:ImageAwesome Icon="TimesCircle"/>
            </Button>
            <!--#endregion-->
        </Grid>
        <!--#endregion-->
        <!--#region Вкладки -->
        <TabControl  Grid.Row="1" TabStripPlacement="Bottom" >
            <!--#region Вкладка управление -->
            <TabItem Header="УПРАВЛЕНИЕ">
                <TabItem.Resources>
                    <ResourceDictionary>
                        <ResourceDictionary.MergedDictionaries>
                            <ResourceDictionary Source="Resourses/Templates/Trends.xaml"/>
                        </ResourceDictionary.MergedDictionaries>
                    </ResourceDictionary>
                </TabItem.Resources>
                <Grid>
                    <!--#region Развбивка на 4 части экрана -->
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition></ColumnDefinition>
                        <ColumnDefinition></ColumnDefinition>
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="1.5*"></RowDefinition>
                        <RowDefinition></RowDefinition>
                    </Grid.RowDefinitions>
                    <!--#endregion-->

                    <!--#region Тренды -->
                    <TabControl TabStripPlacement="Bottom">
                        <!--#region Текущй тренд -->
                        <TabItem Header="Текущий тренд">
                            <!--#region Текущий тренд -->
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="0.1*"></RowDefinition>
                                    <RowDefinition></RowDefinition>
                                </Grid.RowDefinitions>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition></ColumnDefinition>
                                    <ColumnDefinition></ColumnDefinition>
                                    <ColumnDefinition></ColumnDefinition>
                                </Grid.ColumnDefinitions>
                                <DockPanel Grid.Column="0" >
                                    <CheckBox x:Name="VisibleLine1" IsChecked="True"  VerticalAlignment="Center"></CheckBox>
                                    <Label Content="Усредненная физическая величина"  VerticalAlignment="Center"></Label>
                                </DockPanel>
                                <DockPanel Grid.Column="1">
                                    <CheckBox x:Name="VisibleLine2" VerticalAlignment="Center"></CheckBox>
                                    <Label Content="Мгновенная физическая величина"  VerticalAlignment="Center"></Label>
                                </DockPanel>
                                <oxy:Plot Grid.Row="2" Grid.ColumnSpan="4" Tag="{Binding PlotCollection}" Template="{StaticResource Trend}"></oxy:Plot>
                            </Grid>
                            <!--#endregion-->
                        </TabItem>
                        <!--#endregion-->
                        <!--#region Настройки отображения -->
                        <TabItem Header="Настройки отображения">
                            <ListBox HorizontalContentAlignment="Stretch">
                                <!--#region Временоой интервал -->
                                <ListBoxItem Template="{StaticResource TextBoxParameter}" Tag="Максимальное время отображения, мин" 
                                             Content="{Binding TrendSettings.PlotTime, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}">
                                </ListBoxItem>
                                <!--#endregion-->
                                <!--#region Минимальный предел -->
                                <ListBoxItem Template="{StaticResource TextBoxParameterFloat}" Tag="Минимальный предел" 
                                             Content="{Binding TrendSettings.PlotLowLimit, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}">
                                </ListBoxItem>
                                <!--#endregion-->
                                <!--#region Мксимальный предел -->
                                <ListBoxItem Template="{StaticResource TextBoxParameterFloat}" Tag="Максимальный предел" 
                                             Content="{Binding TrendSettings.PlotHighLimit, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}">
                                </ListBoxItem>
                                <!--#endregion-->                                
                            </ListBox>
                        </TabItem>
                        <!--#endregion-->
                        <!--#region Архивный тренд -->
                        <TabItem Header="Архивный тренд">
                            <Grid>
                                <Grid.Resources>
                                    <Style TargetType="Border" BasedOn="{StaticResource BorderLight}"/>
                                    <Style TargetType="TextBlock" BasedOn="{StaticResource Common}"/>
                                </Grid.Resources>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition/>
                                    <ColumnDefinition/>
                                    <ColumnDefinition/>
                                    <ColumnDefinition/>
                                    <ColumnDefinition/>
                                    
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="0.1*"/>
                                    <RowDefinition Height="0.1*"/>
                                    <RowDefinition/>
                                </Grid.RowDefinitions>
                                <!--#region Тренд -->
                                <oxy:Plot  Grid.Row="2" Grid.ColumnSpan="6" Tag="{Binding ArchivalDataPotnts}" Template="{StaticResource Trend}"></oxy:Plot>
                                <fa:ImageAwesome Grid.Row="2" Spin="{Binding ArchivalTrendDownloading}" Visibility="{Binding ArchivalTrendDownloading, Converter={StaticResource VisibleConverter}}"    Grid.ColumnSpan="6" Height="30"   Icon="Refresh" />
                                <!--#endregion-->
                                <!--#region Стартовая точка тренда -->
                                <uc:DateTimeParameter Grid.ColumnSpan="2"
                                                      Description="Стартовая точка тренда"
                                                      PopupOpenedCommand="{Binding SelectDatesCommand}"
                                                      DateTimeWidth="180"
                                                      DateTime="{Binding DisplayDateStart, UpdateSourceTrigger=PropertyChanged, Mode=TwoWay}"/>                               
                                <!--#endregion-->
                                <!--#region Конечная точка тренда -->
                                <uc:DateTimeParameter Grid.Column="2"
                                                      Grid.ColumnSpan="2"
                                                      PopupOpenedCommand="{Binding SelectDatesCommand}"
                                                      Description="Конечная точка тренда"
                                                      DateTimeWidth="180"
                                                      DateTime="{Binding DisplayDateEnd, UpdateSourceTrigger=PropertyChanged, Mode=TwoWay}"/>
                                <!--#endregion-->
                                <!--#region Кнопка "Показать тренд" -->
                                <Button Grid.Column="4" Margin="2" Command="{Binding ShowArchivalTrendCommand}">
                                    <TextBlock  Text="Показать тренд" TextWrapping="Wrap"></TextBlock>
                                </Button>
                                <!--#endregion-->
                                <!--#region Путь к файлу -->
                                <Border Grid.Row="1" Grid.ColumnSpan="3" Margin="2">
                                    <TextBlock x:Name="LogPath" Text="{Binding LogPath, Mode=TwoWay}" VerticalAlignment="Center"></TextBlock>
                                </Border>
                                <!--#endregion-->
                                <!--#region Кнопка Browse -->
                                <Button Grid.Row="1" Click="BrowseLogPath" Grid.Column="3" Margin="2">
                                    <DockPanel>
                                        <fa:ImageAwesome Icon="FolderOutlinepenOutline" Margin="2"/>
                                        <TextBlock Text="Browse" Margin="2" VerticalAlignment="Center" HorizontalAlignment="Center"></TextBlock>
                                    </DockPanel>
                                </Button>
                                <!--#endregion-->
                                <!--#region Кнопка "Запись" -->
                                <Button Grid.Row="1" 
                                        Command="{Binding WriteLogCommand}" 
                                        HorizontalContentAlignment="Stretch" 
                                        Grid.Column="4" Margin="2" 
                                        IsEnabled="{Binding LogPath, Converter={StaticResource FileExistConverter}}">
                                    <DockPanel>
                                        <fa:ImageAwesome 
                                            Margin="2" 
                                            Visibility="{Binding ArchivalTrendUploading, Converter={StaticResource VisibleConverter}}" 
                                            Icon="Refresh" HorizontalAlignment="Center"                                             
                                            Spin="{Binding ArchivalTrendUploading}"/>
                                        <TextBlock Text="Запись" 
                                                   VerticalAlignment="Center"
                                                   HorizontalAlignment="Center"/>
                                    </DockPanel>
                                </Button>
                                <!--#endregion-->

                            </Grid>
                        </TabItem>
                        <!--#endregion-->
                    </TabControl>
                    <!--#endregion-->

                    <!--#region Числовая индикация ФВ -->
                    <Grid Grid.Column="1">
                        <Grid.Resources>
                            <Style TargetType="TextBlock" BasedOn="{StaticResource Common}"/>
                        </Grid.Resources>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition></ColumnDefinition>
                            <ColumnDefinition></ColumnDefinition>
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition></RowDefinition>
                            <RowDefinition></RowDefinition>
                            <RowDefinition></RowDefinition>
                        </Grid.RowDefinitions>
                        <Border Margin="5">
                            <DockPanel>
                                <Label DockPanel.Dock="Top" Content="Усредненное значение"/>
                                <TextBlock  Grid.Column="1" FontSize="36" VerticalAlignment="Center" HorizontalAlignment="Center"
                                            Text="{Binding mainModel.PhysValueAvg.Value, StringFormat={}{0:F1}}"></TextBlock>
                            </DockPanel>
                        </Border>
                        <Border Grid.Column="1" Margin="5">
                            <DockPanel>
                                <Label DockPanel.Dock="Top" Content="Мгновенное значение"/>
                                <TextBlock  Grid.Column="1" FontSize="36" VerticalAlignment="Center" HorizontalAlignment="Center"
                                            Text="{Binding mainModel.PhysValueCur.Value, StringFormat={}{0:F1}}"></TextBlock>
                            </DockPanel>
                        </Border>
                    </Grid>
                    <!--#endregion-->                    

                    <!--#region Кнопки управления -->
                    <Grid Grid.Row="1" Grid.Column="1">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition></ColumnDefinition>
                            <ColumnDefinition></ColumnDefinition>
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition></RowDefinition>
                            <RowDefinition></RowDefinition>
                            <RowDefinition></RowDefinition>
                            <RowDefinition></RowDefinition>
                        </Grid.RowDefinitions>                        
                        <!--#region Кнопка Вкл-выкл измерения -->
                        <Button Grid.Column="0" 
                                Grid.ColumnSpan="2" 
                                Margin="5" 
                                Command="{Binding SwitchMeasCommand}" 
                                Background="{Binding mainModel.CycleMeasStatus.Value, Converter={StaticResource ColorToBool}, ConverterParameter=#FF6A5AcD}">

                            <TextBlock  Text="{Binding mainModel.CycleMeasStatus.Value, Converter={StaticResource StatusFromNum}, ConverterParameter={StaticResource measStatusBtn}}"
                                       IsEnabled="{Binding mainModel.Connecting}"
                                       TextWrapping="Wrap"/>
                        </Button>
                        <!--#endregion-->
                    </Grid>
                    <!--#endregion-->
                    
                </Grid>
            </TabItem>
            <!--#endregion-->
            <!--#region Вкладка настроек -->
            <TabItem Header="НАСТРОЙКИ">
                <TabControl TabStripPlacement="Left">
                    <TabItem Header="КОММУНИКАЦИЯ">
                        <Grid>
                            <ListBox HorizontalContentAlignment="Stretch" >
                                <!--#region Способ связи с платой -->
                                <GroupBox  Header="Способ связи с платой">
                                    <StackPanel>
                                        <RadioButton GroupName="comm"  IsChecked="{Binding mainModel.CommMode.RsEnable}"  Content="RS-485(Modbus RTU)"/>
                                        <RadioButton GroupName="comm"  IsChecked="{Binding mainModel.CommMode.EthEnable}" Content="Ethernet (TCP)"/>
                                        <RadioButton GroupName="comm"  IsChecked="{Binding mainModel.CommMode.HartEnable}" Content="HART"  IsEnabled="False"/>
                                    </StackPanel>
                                </GroupBox>
                                <!--#endregion-->
                                <!--#region Параметры RS485 -->
                                <GroupBox  Header="Настройки RS-485" HorizontalAlignment="Stretch">
                                    <!--#region Параметры RS485 -->
                                    <ListBox>
                                        <!--#region Имя COM порта -->
                                        <ListBoxItem HorizontalContentAlignment="Stretch">
                                            <Grid>
                                                <TextBlock Style="{StaticResource Common}" Text="Имя COM порта" HorizontalAlignment="Left"></TextBlock>
                                                <ComboBox Width="80" HorizontalAlignment="Right" ItemsSource="{Binding ComPorts}" SelectedItem="{Binding mainModel.rs.ComName}">
                                                    <i:Interaction.Triggers>
                                                        <i:EventTrigger EventName="DropDownOpened">
                                                            <i:InvokeCommandAction Command="{Binding UpdateComPortListCommand}"/>
                                                        </i:EventTrigger>
                                                    </i:Interaction.Triggers>
                                                </ComboBox>
                                            </Grid>
                                        </ListBoxItem>
                                        <!--#endregion-->                                        
                                        <!--#region Скорость передачи даных, бит/c -->                                        
                                        <ListBoxItem HorizontalContentAlignment="Stretch">
                                            <Grid>
                                                <TextBlock Style="{StaticResource Common}" Text="Скорость передачи даных, бит/c" HorizontalAlignment="Left"></TextBlock>
                                                <ComboBox  Width="80"   ItemsSource="{StaticResource PortSpeeds}"  SelectedItem="{Binding mainModel.rs.BaudRate}"  HorizontalAlignment="Right"/>
                                            </Grid>
                                        </ListBoxItem>
                                        <!--#endregion-->
                                        <!--#region Паритет-->                                        
                                        <ListBoxItem HorizontalContentAlignment="Stretch">
                                            <Grid>
                                                <TextBlock Style="{StaticResource Common}" Text="Паритет" HorizontalAlignment="Left"></TextBlock>
                                                <ComboBox    Width="80"  ItemsSource="{StaticResource parityes}"    SelectedItem="{Binding mainModel.rs.Par}" HorizontalAlignment="Right"></ComboBox>
                                            </Grid>
                                        </ListBoxItem>
                                        <!--#endregion-->
                                        <!--#region Адрес устройства в сети Modbus -->
                                        <ListBoxItem HorizontalContentAlignment="Stretch">
                                            <Grid>
                                                <TextBlock Style="{StaticResource Common}" Text="Адрес устройства в сети Modbus" HorizontalAlignment="Left"></TextBlock>
                                                <TextBox Text="{Binding mainModel.rs.MbAddr}" HorizontalContentAlignment="Center" Width="80" HorizontalAlignment="Right"></TextBox>
                                            </Grid>
                                        </ListBoxItem>
                                        <!--#endregion-->
                                    </ListBox>
                                    <!--#endregion-->
                                </GroupBox>
                                <!--#endregion-->
                                <!--#region Параметры  Ethernet-->
                                <GroupBox Header="Настройки Ethernet(TCP) соединения">
                                    <ListBox HorizontalContentAlignment="Stretch">
                                        <ListBoxItem Content="{Binding mainModel.Tcp.IP, UpdateSourceTrigger=PropertyChanged, Mode=TwoWay}"  HorizontalAlignment="Stretch" Template="{StaticResource TextBoxParameter}"  Tag="IP адрес устройства"></ListBoxItem>
                                        <ListBoxItem Content="{Binding mainModel.Tcp.PortNum, UpdateSourceTrigger=PropertyChanged, Mode=TwoWay}" HorizontalAlignment="Stretch" Template="{StaticResource TextBoxParameter}"  Tag="Номер порта"></ListBoxItem>
                                    </ListBox>
                                </GroupBox>
                                <!--#endregion-->
                                <!--#region Настройки последовательного порта плотномера -->
                                <GroupBox Header="Настройки последовательного порта плотномера">
                                    <ListBox HorizontalContentAlignment="Stretch">
                                        <!--#region Баудрейт -->
                                        <ListBoxItem DataContext="{Binding mainModel.PortBaudrate}">
                                            <uc:CompoboxParameter CompoboxWidth="80"
                                                                  ItemSource="{StaticResource PortSpeeds}"
                                                                  SelectedItem="{Binding Value, UpdateSourceTrigger=PropertyChanged, Mode=TwoWay}"
                                                                  Command="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=Window}, Path=DataContext.ChangeBaudrateCommand}"
                                                                  CommanDParameter="{Binding RelativeSource={RelativeSource Self}, Path=SelectedItem}"/>
                                        </ListBoxItem>
                                        <!--#endregion-->
                                        <!--#region Режим работы -->
                                        <ListBoxItem DataContext="{Binding mainModel.PortSelectMode}">
                                            <uc:CompoboxParameter CompoboxWidth="80"
                                                                  ItemSource="{StaticResource PortModes}"
                                                                  Index="{Binding Value}"
                                                                  Command="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=Window}, Path=DataContext.ChangeSerialSelectCommand}"
                                                                  CommanDParameter="{Binding RelativeSource={RelativeSource Self}, Path=Index}"/>
                                        </ListBoxItem>
                                        <!--#endregion-->
                                    </ListBox>
                                </GroupBox>
                                <!--#endregion-->
                            </ListBox>
                        </Grid>
                    </TabItem>
                    <TabItem Header="ИЗМЕРЕНИЕ" >
                        <ListBox HorizontalContentAlignment="Stretch">
                            <ListBox.Resources>
                                <Style TargetType="TextBlock" BasedOn="{StaticResource Common}"/>
                            </ListBox.Resources>
                            <ListBoxItem>
                                <DockPanel>
                                    <TextBlock Text="Выбор текущего измерительного процесса"></TextBlock>
                                    <ComboBox Name="CurMeasSelector" ItemsSource="{Binding MeasProcessNames.Data}" 
                                              DisplayMemberPath="Name" 
                                              SelectedIndex="{Binding mainModel.CurMeasProcessNum.Value}"                                              
                                              HorizontalAlignment="Right">
                                        <i:Interaction.Triggers>
                                            <i:EventTrigger EventName="SelectionChanged">
                                                <i:InvokeCommandAction Command="{Binding ChangeMeasProcessCommand}" CommandParameter="{Binding ElementName=CurMeasSelector, Path=SelectedIndex}"/>
                                            </i:EventTrigger>
                                        </i:Interaction.Triggers>
                                    </ComboBox>                                    
                                </DockPanel>
                            </ListBoxItem>
                            <!--#region Время усреднения -->
                            <ListBoxItem HorizontalContentAlignment="Stretch">
                                <DockPanel>
                                    <TextBlock Style="{StaticResource Common}" Text="Время усреднения, сек"/>
                                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                                        <TextBox Text="{Binding AvgTimeWrite}" Width="50" ></TextBox>
                                        <Button Width="50" Margin="5,0,5,0" HorizontalAlignment="Right"
                                                            Command="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=Window}, Path=DataContext.ChangeUserAvgTime}"
                                                            CommandParameter="{Binding AvgTimeWrite}">--></Button>
                                        <Border Width="50" HorizontalAlignment="Right">
                                            <TextBlock Margin="1,0,1,0" 
                                                       IsEnabled="False" 
                                                       HorizontalAlignment="Left">
                                                <TextBlock.Text>
                                                    <MultiBinding Converter="{StaticResource MultiplyNumsConverter}">
                                                        <Binding Path="mainModel.CurMeasProcess.MeasDeep.Value"/>
                                                        <Binding Path="mainModel.CurMeasProcess.MeasDuration.Value" />
                                                    </MultiBinding>
                                                </TextBlock.Text>
                                            </TextBlock>
                                        </Border>
                                    </StackPanel>
                                </DockPanel>
                            </ListBoxItem>
                            <!--#endregion-->
                        </ListBox>
                    </TabItem>
                    <TabItem Header="ДАТА И ВРЕМЯ">
                        <Grid>
                            <Grid.Resources>
                                <Style TargetType="TextBlock" BasedOn="{StaticResource Common}"/>
                            </Grid.Resources>
                            <Grid.RowDefinitions>
                                <RowDefinition/>
                                <RowDefinition/>
                            </Grid.RowDefinitions>
                            <ListBox HorizontalContentAlignment="Stretch">
                                <!--#region Реадктирование rtc -->
                                <ListBoxItem>
                                    <DockPanel>
                                        <TextBlock Text="{Binding mainModel.Rtc.Description}"/>
                                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                                            <wpftool:DateTimePicker Name="Dt" Value="{Binding mainModel.Rtc.WriteValue}" Margin="1,0,1,0"></wpftool:DateTimePicker>
                                            <Button Command="{Binding SetRtcCommand}" Width="50" Margin="1,0,1,0">--></Button>
                                        </StackPanel>
                                    </DockPanel>
                                </ListBoxItem>
                                <!--#endregion-->
                                <!--#region Синхронизация с временем ПК -->
                                <ListBoxItem>
                                    <DockPanel>
                                        <TextBlock Text="{Binding CurPcDateTime.Description}"></TextBlock>
                                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                                            <TextBlock Margin="1,0,1,0"  Width="{Binding ElementName=Dt, Path=ActualWidth}" 
                                                       Text="{Binding CurPcDateTime.Value, StringFormat=F,   UpdateSourceTrigger=PropertyChanged, ConverterCulture=ru-RU,  Mode=OneWay}"
                                                       HorizontalAlignment="Center"></TextBlock>
                                            <Button Command="{Binding SyncRtcCommand}" Width="50" Margin="1,0,1,0">--></Button>
                                        </StackPanel>
                                    </DockPanel>
                                </ListBoxItem>
                                <!--#endregion-->                                
                            </ListBox> 
                        </Grid>                       
                    </TabItem>
                </TabControl>
            </TabItem>
            <!--#endregion-->
            <!--#region Расширенные настройки -->
            <TabItem Header="РАСШИРЕННЫЕ НАСТРОЙКИ" Visibility="{Binding CurUser, Converter={StaticResource UserToVisibility}, ConverterParameter=Администратор}">
                <TabItem.Resources>
                    <!--#region Общий стиль для DaraGrid -->
                    <Style TargetType="DataGrid">
                        <Setter Property="VerticalGridLinesBrush" Value="DarkGray"/>
                        <Setter Property="GridLinesVisibility" Value="Vertical"/>
                        <Setter Property="AlternatingRowBackground" Value="AliceBlue"/>
                        <Setter Property="AutoGenerateColumns" Value="False"/>
                    </Style>
                    <!--#endregion-->
                </TabItem.Resources>
                <TabControl TabStripPlacement="Left">                    
                    <!--#region Настройки измерительных процессов -->
                    <TabItem Header="ИЗМЕРИТЕЛЬНЫЕ ПРОЦЕССЫ">
                        <GroupBox>                            
                            <!--#region Выбор измерительного процесса -->
                            <GroupBox.Header>
                                <DockPanel>
                                    <TextBlock Text="Название измерительного процесса"></TextBlock>
                                    <ComboBox Name="Selector" HorizontalAlignment="Right" 
                                              ItemsSource="{Binding MeasProcessNames.Data}"
                                              DisplayMemberPath="Name"
                                              Margin="10,0"
                                              SelectedIndex="{Binding SelectedMeasProcessNum}"  ></ComboBox>
                                </DockPanel>
                            </GroupBox.Header>
                            <!--#endregion-->
                            <!--#region Параметры -->                            
                            <ListBox HorizontalContentAlignment="Stretch">
                                <!--#region Диапазоны -->
                                <ListBoxItem HorizontalContentAlignment="Stretch">                                    
                                    <GroupBox>
                                        <!--#region Выбор диапазона -->
                                        <GroupBox.Header>
                                            <DockPanel>
                                                <TextBlock Text="Номер диапазона"></TextBlock>
                                                <ComboBox ItemsSource="{StaticResource Diapasons}" 
                                                          SelectedIndex="{Binding  SelectedDiapNum}"/>
                                            </DockPanel>
                                        </GroupBox.Header>
                                        
                                        <!--#endregion-->
                                        <!--#region Настройки диапазонов -->
                                        <ListBox>                                            
                                            <!--#region Номер калибровочной кривой -->
                                            <ListBoxItem HorizontalContentAlignment="Stretch" DataContext="{Binding SelectedDiap.CalibCurveNum}">
                                                <uc:Parameter Command="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=Window}, Path=DataContext.SetCalibCurveDiapCommand}"/>                                                
                                            </ListBoxItem>                                           
                                            <!--#endregion-->
                                            <!--#region Номер стандартизации ЕИ -->
                                            <ListBoxItem HorizontalContentAlignment="Stretch" DataContext="{Binding SelectedDiap.StandNum}">
                                                <uc:Parameter Command="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=Window}, Path=DataContext.SetStandNumDiapCommand}"/>                                                
                                            </ListBoxItem>
                                            <!--#endregion-->
                                            <!--#region Счетчик -->
                                            <ListBoxItem HorizontalContentAlignment="Stretch" DataContext="{Binding SelectedDiap.CounterNum}">
                                                <uc:Parameter Command="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=Window}, Path=DataContext.SetCounterDiapCommand}"/>
                                            </ListBoxItem>
                                            <!--#endregion-->
                                        </ListBox>
                                        <!--#endregion-->
                                    </GroupBox>                                    
                                </ListBoxItem>
                                <!--#endregion--> 
                                <!--#region Номер стандартизации -->
                                <ListBoxItem HorizontalContentAlignment="Stretch" DataContext="{Binding SelectedMeasProcess.BackStandNum}">
                                    <uc:Parameter Command="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=Window}, Path=DataContext.SetStandNumCommand}"/>
                                </ListBoxItem>
                                <!--#endregion-->
                                <!--#region Время измерения, x0.1 c -->
                                <ListBoxItem HorizontalContentAlignment="Stretch" DataContext="{Binding SelectedMeasProcess.MeasDuration}">
                                    <uc:Parameter Command="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=Window}, Path=DataContext.SetMeasDurationCommand}"/>                                    
                                </ListBoxItem>
                                <!--#endregion-->
                                <!--#region Глубина усреднения, точек измерения -->
                                <ListBoxItem HorizontalContentAlignment="Stretch" DataContext="{Binding SelectedMeasProcess.MeasDeep}">
                                    <uc:Parameter Command="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=Window}, Path=DataContext.SetMeasDeepCommand}"/>                                    
                                </ListBoxItem>
                                <!--#endregion-->
                                <!--#region Период полупаспада -->
                                <ListBoxItem HorizontalContentAlignment="Stretch" DataContext="{Binding SelectedMeasProcess.HalfLife}">
                                    <uc:Parameter Command="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=Window}, Path=DataContext.SetHalfLifeCommand}"/>                                   
                                </ListBoxItem>
                                <!--#endregion-->
                                <!--#region Плотность жидкости -->
                                <ListBoxItem HorizontalContentAlignment="Stretch" DataContext="{Binding SelectedMeasProcess.DensityLiquid}">
                                    <uc:Parameter Command="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=Window}, Path=DataContext.SetDensityLiqCommand}"/>                                    
                                </ListBoxItem>
                                <!--#endregion-->
                                <!--#region Плотность твердости -->
                                <ListBoxItem HorizontalContentAlignment="Stretch" DataContext="{Binding SelectedMeasProcess.DensitySolid}">
                                    <uc:Parameter Command="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=Window}, Path=DataContext.SetDensitySolidCommand}"/>                                   
                                </ListBoxItem>
                                <!--#endregion-->
                            </ListBox>                                
                            <!--#endregion-->
                        </GroupBox>
                    </TabItem>
                    <!--#endregion-->
                    <!--#region Настройки счетчиков -->
                    <TabItem Header="СЧЕТЧИКИ">
                        <DataGrid ItemsSource="{Binding mainModel.CountDiapasones}"
                                  CanUserAddRows="False"
                                  CanUserDeleteRows="False"
                                  CanUserReorderColumns="False"
                                  AutoGenerateColumns="False">
                            <DataGrid.Columns>
                                <!--#region № -->
                                <DataGridTextColumn  IsReadOnly="True" Header="№" Binding="{Binding Num.Value}"/>
                                <!--#endregion-->
                                <!--#region Начальный номер -->
                                <DataGridTemplateColumn Header="Начальный номер">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <DockPanel>
                                                <TextBox Width="50"
                                                         VerticalContentAlignment="Center"
                                                         HorizontalContentAlignment="Center">
                                                    <TextBox.Text>
                                                        <Binding Path="Start.WriteValue" UpdateSourceTrigger="PropertyChanged" Mode="TwoWay">
                                                            <Binding.ValidationRules>
                                                                <DataErrorValidationRule />
                                                            </Binding.ValidationRules>
                                                        </Binding>
                                                    </TextBox.Text>
                                                </TextBox>
                                                <Button Margin="5,0,5,0"
                                                        Command="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=Window}, Path=DataContext.ChangeCounterDiapStartCommand}"
                                                        CommandParameter="{Binding Num.Value}">--></Button>
                                                <TextBlock Text="{Binding Start.Value}"
                                                           VerticalAlignment="Center"
                                                           Style="{StaticResource Common}"
                                                           Foreground="Black"/>
                                            </DockPanel>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>
                                <!--#endregion-->
                                <!--#region Конечный номер -->
                                <DataGridTemplateColumn Header="Конечный номер">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <DockPanel>
                                                <TextBox Width="50"
                                                         VerticalContentAlignment="Center"
                                                         HorizontalContentAlignment="Center">
                                                    <TextBox.Text>
                                                        <Binding Path="Finish.WriteValue" UpdateSourceTrigger="PropertyChanged" Mode="TwoWay">
                                                            <Binding.ValidationRules>
                                                                <DataErrorValidationRule />
                                                            </Binding.ValidationRules>
                                                        </Binding>
                                                    </TextBox.Text>
                                                </TextBox>
                                                <Button Margin="5,0,5,0"
                                                        Command="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=Window}, Path=DataContext.ChangeCounterDiapFinishCommand}"
                                                        CommandParameter="{Binding Num.Value}">--></Button>
                                                <TextBlock Text="{Binding Finish.Value}"
                                                           Width="50"
                                                           VerticalAlignment="Center"
                                                           Style="{StaticResource Common}"
                                                           Foreground="Black"/>
                                            </DockPanel>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>
                                <!--#endregion-->


                            </DataGrid.Columns>
                        </DataGrid>
                    </TabItem>
                    <!--#endregion-->
                    <!--#region Калибровочные криые -->
                    <TabItem Header="КАЛИБРОВОЧНЫЕ КРИВЫЕ">
                        <DataGrid ItemsSource="{Binding mainModel.CalibrDatas}">
                            <DataGrid.Columns>
                                <!--#region № -->
                                <DataGridTextColumn Header="№" IsReadOnly="True"  Binding="{Binding Num.Value}"/>
                                <!--#endregion-->
                                <!--#region Единица измерения -->                                
                                <DataGridTemplateColumn Header="Единица измерения">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <ComboBox ItemsSource="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=Window}, Path=DataContext.UnitNames.Data}"
                                                      DisplayMemberPath="Name"
                                                      SelectedIndex="{Binding MeasUnitNum.WriteValue, UpdateSourceTrigger=LostFocus}">
                                                <i:Interaction.Triggers>
                                                    <i:EventTrigger EventName="DropDownClosed">
                                                        <i:InvokeCommandAction Command="{Binding SetMeasUnitCommand}"/>
                                                    </i:EventTrigger>
                                                </i:Interaction.Triggers>
                                            </ComboBox>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>
                                <!--#endregion-->
                                <!--#region К-т 0 -->
                                <DataGridTemplateColumn Header="Коэффициент 0">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate DataType="">
                                            <DockPanel>
                                                <TextBox Width="50"
                                                         VerticalContentAlignment="Center"
                                                         HorizontalContentAlignment="Center">
                                                    <TextBox.Text>
                                                        <Binding Path="Coeffs[0].WriteValue" UpdateSourceTrigger="LostFocus" StringFormat="{}{0:#.##}">
                                                            <Binding.ValidationRules>
                                                                <DataErrorValidationRule />
                                                            </Binding.ValidationRules>
                                                        </Binding>
                                                    </TextBox.Text>
                                                </TextBox>
                                                <Button Margin="5,0,5,0"
                                                        Command="{Binding SetCoeffCommand}"
                                                        CommandParameter="0"
                                                        >--></Button>
                                                <TextBlock Text="{Binding Coeffs[0].Value}"
                                                           Width="50"                                                           
                                                           VerticalAlignment="Center"
                                                           Style="{StaticResource Common}"
                                                           Foreground="Black"/>
                                            </DockPanel>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>
                                <!--#endregion-->
                                <!--#region К-т 1 -->
                                <DataGridTemplateColumn Header="Коэффициент 1">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate DataType="">
                                            <DockPanel>
                                                <TextBox Width="50"
                                                         VerticalContentAlignment="Center"
                                                         HorizontalContentAlignment="Center">
                                                    <TextBox.Text>
                                                        <Binding Path="Coeffs[1].WriteValue" UpdateSourceTrigger="LostFocus" >
                                                            <Binding.ValidationRules>
                                                                <DataErrorValidationRule />
                                                            </Binding.ValidationRules>
                                                        </Binding>
                                                    </TextBox.Text>
                                                </TextBox>
                                                <Button Margin="5,0,5,0"
                                                        Command="{Binding SetCoeffCommand}"
                                                        CommandParameter="1"
                                                        >--></Button>
                                                <TextBlock Text="{Binding Coeffs[1].Value}"
                                                           Width="50"
                                                           VerticalAlignment="Center"
                                                           Style="{StaticResource Common}"
                                                           Foreground="Black"/>
                                            </DockPanel>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>
                                <!--#endregion-->
                                <!--#region К-т 2 -->
                                <DataGridTemplateColumn Header="Коэффициент 2">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate DataType="">
                                            <DockPanel>
                                                <TextBox Width="50"
                                                         VerticalContentAlignment="Center"
                                                         HorizontalContentAlignment="Center">
                                                    <TextBox.Text>
                                                        <Binding Path="Coeffs[2].WriteValue" UpdateSourceTrigger="LostFocus" >
                                                            <Binding.ValidationRules>
                                                                <DataErrorValidationRule />
                                                            </Binding.ValidationRules>
                                                        </Binding>
                                                    </TextBox.Text>
                                                </TextBox>
                                                <Button Margin="5,0,5,0"
                                                        Command="{Binding SetCoeffCommand}"
                                                        CommandParameter="2"
                                                        >--></Button>
                                                <TextBlock Text="{Binding Coeffs[2].Value}"
                                                           Width="50"
                                                           VerticalAlignment="Center"
                                                           Style="{StaticResource Common}"
                                                           Foreground="Black"/>
                                            </DockPanel>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>
                                <!--#endregion-->
                                <!--#region К-т 3 -->
                                <DataGridTemplateColumn Header="Коэффициент 3">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate DataType="">
                                            <DockPanel>
                                                <TextBox Width="50"
                                                         VerticalContentAlignment="Center"
                                                         HorizontalContentAlignment="Center">
                                                    <TextBox.Text>
                                                        <Binding Path="Coeffs[3].WriteValue" UpdateSourceTrigger="LostFocus" >
                                                            <Binding.ValidationRules>
                                                                <DataErrorValidationRule />
                                                            </Binding.ValidationRules>
                                                        </Binding>
                                                    </TextBox.Text>
                                                </TextBox>
                                                <Button Margin="5,0,5,0"
                                                        Command="{Binding SetCoeffCommand}"
                                                        CommandParameter="3"
                                                        >--></Button>
                                                <TextBlock Text="{Binding Coeffs[3].Value}"
                                                           Width="50"
                                                           VerticalAlignment="Center"
                                                           Style="{StaticResource Common}"
                                                           Foreground="Black"/>
                                            </DockPanel>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>
                                <!--#endregion-->
                                <!--#region К-т 4 -->
                                <DataGridTemplateColumn Header="Коэффициент 4">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate DataType="">
                                            <DockPanel>
                                                <TextBox Width="50"
                                                         VerticalContentAlignment="Center"
                                                         HorizontalContentAlignment="Center">
                                                    <TextBox.Text>
                                                        <Binding Path="Coeffs[4].WriteValue" UpdateSourceTrigger="LostFocus" >
                                                            <Binding.ValidationRules>
                                                                <DataErrorValidationRule />
                                                            </Binding.ValidationRules>
                                                        </Binding>
                                                    </TextBox.Text>
                                                </TextBox>
                                                <Button Margin="5,0,5,0"
                                                        Command="{Binding SetCoeffCommand}"
                                                        CommandParameter="4"
                                                        >--></Button>
                                                <TextBlock Text="{Binding Coeffs[4].Value}"
                                                           Width="50"
                                                           VerticalAlignment="Center"
                                                           Style="{StaticResource Common}"
                                                           Foreground="Black"/>
                                            </DockPanel>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>
                                <!--#endregion-->
                                <!--#region К-т 5 -->
                                <DataGridTemplateColumn Header="Коэффициент 5">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate DataType="">
                                            <DockPanel>
                                                <TextBox Width="50"
                                                         VerticalContentAlignment="Center"
                                                         HorizontalContentAlignment="Center">
                                                    <TextBox.Text>
                                                        <Binding Path="Coeffs[5].WriteValue" UpdateSourceTrigger="LostFocus" >
                                                            <Binding.ValidationRules>
                                                                <DataErrorValidationRule />
                                                            </Binding.ValidationRules>
                                                        </Binding>
                                                    </TextBox.Text>
                                                </TextBox>
                                                <Button Margin="5,0,5,0"
                                                        Command="{Binding SetCoeffCommand}"
                                                        CommandParameter="5"
                                                        >--></Button>
                                                <TextBlock Text="{Binding Coeffs[5].Value}"
                                                           Width="50"
                                                           VerticalAlignment="Center"
                                                           Style="{StaticResource Common}"
                                                           Foreground="Black"/>
                                            </DockPanel>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>
                                <!--#endregion-->
                            </DataGrid.Columns>
                        </DataGrid>
                    </TabItem>
                    <!--#endregion-->
                    <!--#region Стандартизация -->
                    <TabItem Header="СТАНДАРТИЗАЦИЯ">
                        <GroupBox>
                            <!--#region Выбор набора станд-ии -->
                            <GroupBox.Header>
                                <DockPanel>
                                    <TextBlock Text="Номер набора стандартизации"/>
                                    <ComboBox ItemsSource="{Binding StandNames.Data}"
                                              HorizontalAlignment="Right"
                                              SelectedIndex="{Binding StandSelNum}"
                                              DisplayMemberPath="Name"/>
                                </DockPanel>
                            </GroupBox.Header>
                            <!--#endregion-->
                            <ListBox>
                                <!--#region Длительность стандартизации -->
                                <ListBoxItem DataContext="{Binding SelectedStandData.Duration}" HorizontalContentAlignment="Stretch">
                                    <uc:Parameter Command="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=Window}, Path=DataContext.SetStdDurationCommand}"/>
                                </ListBoxItem>
                                <!--#endregion-->
                                <!--#region Тип -->
                                <ListBoxItem DataContext="{Binding SelectedStandData.Type}" HorizontalContentAlignment="Stretch">
                                    <uc:Parameter Command="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=Window}, Path=DataContext.SetStdTypeCommand}"/>
                                </ListBoxItem>
                                <!--#endregion-->
                                <!--#region Физ. величина -->
                                <ListBoxItem DataContext="{Binding SelectedStandData.Value}" HorizontalContentAlignment="Stretch">
                                    <uc:Parameter Command="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=Window}, Path=DataContext.SetStdValueCommand}"/>
                                </ListBoxItem>
                                <!--#endregion-->
                                <!--#region Результаты -->
                                <ListBoxItem DataContext="{Binding SelectedStandData.Results[0]}" HorizontalContentAlignment="Stretch">
                                    <uc:Parameter Command="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=Window}, Path=DataContext.SetStdResultCommand}"
                                                  CommanDParameter="0"/>
                                </ListBoxItem>
                                <ListBoxItem DataContext="{Binding SelectedStandData.Results[1]}" HorizontalContentAlignment="Stretch">
                                    <uc:Parameter Command="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=Window}, Path=DataContext.SetStdResultCommand}"
                                                  CommanDParameter="1"/>
                                </ListBoxItem>
                                <ListBoxItem DataContext="{Binding SelectedStandData.Results[2]}" HorizontalContentAlignment="Stretch">
                                    <uc:Parameter Command="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=Window}, Path=DataContext.SetStdResultCommand}"
                                                  CommanDParameter="2"/>
                                </ListBoxItem>
                                <ListBoxItem DataContext="{Binding SelectedStandData.Results[3]}" HorizontalContentAlignment="Stretch">
                                    <uc:Parameter Command="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=Window}, Path=DataContext.SetStdResultCommand}"
                                                  CommanDParameter="3"/>
                                </ListBoxItem>
                                <ListBoxItem DataContext="{Binding SelectedStandData.Results[4]}" HorizontalContentAlignment="Stretch">
                                    <uc:Parameter Command="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=Window}, Path=DataContext.SetStdResultCommand}"
                                                  CommanDParameter="4"/>
                                </ListBoxItem>
                                <ListBoxItem DataContext="{Binding SelectedStandData.Results[5]}" HorizontalContentAlignment="Stretch">
                                    <uc:Parameter Command="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=Window}, Path=DataContext.SetStdResultCommand}"
                                                  CommanDParameter="5"/>
                                </ListBoxItem>
                                <ListBoxItem DataContext="{Binding SelectedStandData.Results[6]}" HorizontalContentAlignment="Stretch">
                                    <uc:Parameter Command="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=Window}, Path=DataContext.SetStdResultCommand}"
                                                  CommanDParameter="6"/>
                                </ListBoxItem>
                                <ListBoxItem DataContext="{Binding SelectedStandData.Results[7]}" HorizontalContentAlignment="Stretch">
                                    <uc:Parameter Command="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=Window}, Path=DataContext.SetStdResultCommand}"
                                                  CommanDParameter="7"/>
                                </ListBoxItem>
                                <!--#endregion-->
                                <!--#region Время последней стандартизации -->
                                <ListBoxItem HorizontalContentAlignment="Stretch">
                                    <DockPanel>
                                        <TextBlock  Text="{Binding SelectedStandData.Date.Description}"
                                                    Style="{StaticResource Common}"/>
                                        <TextBlock  Text="{Binding SelectedStandData.Date.Value, StringFormat=F,   UpdateSourceTrigger=PropertyChanged, ConverterCulture=ru-RU,  Mode=OneWay}"
                                                    HorizontalAlignment="Right"                                                    
                                                    Style="{StaticResource Common}"/>
                                    </DockPanel>
                                </ListBoxItem>
                                <!--#endregion-->
                                <ListBoxItem HorizontalContentAlignment="Stretch">
                                    <DockPanel>
                                        <TextBlock Text="Управление стандартизацией" Style="{StaticResource Common}" />
                                        <Button Width="200" Height="Auto"
                                                Command="{Binding MakeStandCommand}"
                                                HorizontalContentAlignment="Center"
                                                HorizontalAlignment="Right">
                                            <TextBlock Text="{Binding IsStandartisation, Converter={StaticResource StatusFromNum}, ConverterParameter={StaticResource StandStates}}"
                                                       TextWrapping="Wrap"/>
                                        </Button>
                                    </DockPanel>                                    
                                </ListBoxItem>

                            </ListBox>
                        </GroupBox>
                    </TabItem>
                    <!--#endregion-->
                    <!--#region Настройки платы HV -->
                    <TabItem Header="ПЛАТА HV" >
                        <ListBox HorizontalContentAlignment="Stretch" >
                            <!--#region Уставка напряжения -->                           
                            <ListBoxItem DataContext="{Binding mainModel.TelemetryHV.VoltageSV}">
                                <uc:Parameter Command="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=DataContext.SetHvCommand}" />
                            </ListBoxItem>
                            <!--#endregion-->
                            <!--#region Входное напряжение -->
                            <ListBoxItem DataContext="{Binding mainModel.TelemetryHV.VoltageCurIn}">
                                <uc:Parameter/>
                            </ListBoxItem>
                            <!--#endregion-->
                            <!--#region Выходное напряжение -->
                            <ListBoxItem DataContext="{Binding mainModel.TelemetryHV.VoltageCurOut}">
                                <uc:Parameter/>
                            </ListBoxItem>
                            <!--#endregion-->
                            <!--#region Индикатор связи -->
                            <ListBoxItem DataContext="{Binding mainModel.TelemetryHV.HvCommState}">
                                <UserControl Template="{StaticResource BitIndicator}"/>
                            </ListBoxItem>
                            <!--#endregion-->
                            <!--#region Кнопка включения-выключения HV -->
                            <ListBoxItem>
                                <DockPanel>                                    
                                    <TextBlock Style="{StaticResource Common}" 
                                               Text="Управление Высоким напряжением"/>
                                    <Button Width="220" Height="Auto" HorizontalAlignment="Right"
                                            Background="{Binding mainModel.TelemetryHV.HvOn.Value, Converter={StaticResource ColorToBool}, ConverterParameter=#FFFF0000}"
                                            Command="{Binding SwitchHvCommand}">
                                        <TextBlock TextWrapping="Wrap" 
                                                   Text="{Binding mainModel.TelemetryHV.HvOn.Value, Converter={StaticResource StatusFromNum}, ConverterParameter={StaticResource HvButn}}"
                                                   ></TextBlock>
                                    </Button>
                                </DockPanel>                                
                            </ListBoxItem>
                            <!--#endregion-->
                        </ListBox>
                    </TabItem>
                    <!--#endregion-->
                    <!--#region Плата питания -->
                    <TabItem Header="ПЛАТА ПИТАНИЯ">
                        <ListBox HorizontalContentAlignment="Stretch">
                            <!--#region Температура -->
                            <ListBoxItem DataContext="{Binding mainModel.TempTelemetry.TempInternal}" >
                                <uc:Parameter/>
                            </ListBoxItem>
                            <!--#endregion-->

                            <!--#region Индикатор связи -->
                            <ListBoxItem DataContext="{Binding mainModel.TempTelemetry.TempBoardCommState}">
                                <UserControl Template="{StaticResource BitIndicator}"/>
                            </ListBoxItem>
                            <!--#endregion-->
                        </ListBox>
                    </TabItem>
                    <!--#endregion-->
                    <!--#region Плата АЦП -->
                    <TabItem Header="ПЛАТА АЦП">
                        <ListBox>
                            <ListBoxItem HorizontalContentAlignment="Stretch">
                                <UserControl Template="{StaticResource BitIndicator}" DataContext="{Binding mainModel.AdcBoard.CommState}"/>
                            </ListBoxItem>
                        </ListBox>                        
                    </TabItem>
                    <!--#endregion-->
                    <!--#region АНАЛОГОВЫЕ МОДУЛИ -->
                    <TabItem Header="АНАЛОГОВЫЕ МОДУЛИ">                        
                            <DockPanel>                                
                                <!--#region  Аналоговые входы -->
                                <GroupBox DockPanel.Dock="Top" Header="АНАЛОГОВЫЕ ВХОДЫ">
                                    <DataGrid AutoGenerateColumns="False" CanUserAddRows="False" CanUserDeleteRows="False" ItemsSource="{Binding AnalogInputs}" >
                                        <DataGrid.Columns>
                                            <!--#region Id -->
                                            <DataGridTextColumn IsReadOnly="True"  Header="№" Binding="{Binding GroupNum}"/>
                                            <!--#endregion-->
                                            <!--#region Связь  -->
                                            <DataGridTemplateColumn Header="Связь">
                                                <DataGridTemplateColumn.CellTemplate>
                                                    <DataTemplate DataType="add:AnalogInput">
                                                        <Rectangle Fill="{Binding CommState.Value, Converter={StaticResource ColorToBool}}"/>
                                                    </DataTemplate>
                                                </DataGridTemplateColumn.CellTemplate>
                                            </DataGridTemplateColumn>
                                            <!--#endregion-->
                                            <!--#region Питание -->
                                            <DataGridTemplateColumn Header="Питание">
                                                <DataGridTemplateColumn.CellTemplate >
                                                    <DataTemplate DataType="add:AnalogInput">
                                                        <Button Content="{Binding PwrState.Value, Converter={StaticResource StatusFromNum}, ConverterParameter={StaticResource PwrBtnStatus}}"
                                                                Background="{Binding PwrState.Value, Converter={StaticResource ColorToBool}}"
                                                                Command="{Binding SwitchPwrAmCommand}"></Button>
                                                    </DataTemplate>
                                                </DataGridTemplateColumn.CellTemplate>
                                            </DataGridTemplateColumn>
                                            <!--#endregion-->
                                            <!--#region АЦП -->
                                            <DataGridTextColumn Header="Напряжение АЦП, мВ" Binding="{Binding AdcValue.Value}" IsReadOnly="True"/>
                                            <!--#endregion-->
                                            <!--#region Тип протокола -->
                                            <DataGridTemplateColumn Header="Тип протокола">
                                                <DataGridTemplateColumn.CellTemplate>
                                                    <DataTemplate DataType="add:AnalogInput">
                                                        <ComboBox ItemsSource="{StaticResource AnalogProtocols}" SelectedIndex="{Binding Protocol.WriteValue}"></ComboBox>
                                                    </DataTemplate>
                                                </DataGridTemplateColumn.CellTemplate>
                                            </DataGridTemplateColumn>
                                            <!--#endregion-->
                                        <!--#region Активность -->
                                        <DataGridTemplateColumn Width="120">
                                            <DataGridTemplateColumn.Header>
                                                <TextBlock Text="Активность АЦП" TextWrapping="Wrap"/>
                                            </DataGridTemplateColumn.Header>
                                            <DataGridTemplateColumn.CellTemplate>
                                                <DataTemplate DataType="add:AnalogInput">
                                                    <ComboBox ItemsSource="{StaticResource On/Off}" SelectedIndex="{Binding Activity.Value, UpdateSourceTrigger=PropertyChanged, Mode=TwoWay}">
                                                        <i:Interaction.Triggers>
                                                            <i:EventTrigger EventName="DropDownClosed">
                                                                <i:InvokeCommandAction Command="{Binding SetSettingsCommand}"/>
                                                            </i:EventTrigger>
                                                        </i:Interaction.Triggers>
                                                    </ComboBox>
                                                </DataTemplate>
                                            </DataGridTemplateColumn.CellTemplate>
                                        </DataGridTemplateColumn>
                                        <!--#endregion-->
                                    </DataGrid.Columns>
                                    </DataGrid>
                                </GroupBox>
                                <!--#endregion-->
                                <!--#region Аналоговые выходы -->
                                <GroupBox DockPanel.Dock="Bottom" Header="АНАЛОГОВЫЕ ВЫХОДЫ">
                                    <DataGrid  AutoGenerateColumns="False" CanUserAddRows="False" CanUserDeleteRows="False" ItemsSource="{Binding AnalogOutputs}">
                                       <DataGrid.Columns>
                                       <!--#region Id -->
                                            <DataGridTextColumn Binding="{Binding GroupNum}" IsReadOnly="True"  Header="№"/>
                                            <!--#endregion-->
                                       <!--#region Связь -->
                                            <DataGridTemplateColumn Header="Связь">
                                                <DataGridTemplateColumn.CellTemplate>
                                                    <DataTemplate DataType="add:AnalogOutput">
                                                        <Rectangle Fill="{Binding CommState.Value, Converter={StaticResource ColorToBool}}"/>
                                                    </DataTemplate>
                                                </DataGridTemplateColumn.CellTemplate>
                                            </DataGridTemplateColumn>
                                            <!--#endregion-->
                                       <!--#region Питание -->
                                            <DataGridTemplateColumn Header="Питание">
                                                <DataGridTemplateColumn.CellTemplate>
                                                    <DataTemplate DataType="add:AnalogOutput">
                                                        <Button Content="{Binding PwrState.Value, Converter={StaticResource StatusFromNum}, ConverterParameter={StaticResource PwrBtnStatus}}"
                                                                Background="{Binding PwrState.Value, Converter={StaticResource ColorToBool}}"
                                                                Command="{Binding SwitchPwrAmCommand}" ></Button>
                                                    </DataTemplate>
                                                </DataGridTemplateColumn.CellTemplate>
                                            </DataGridTemplateColumn>
                                        <!--#endregion-->
                                       <!--#region ЦАП -->
                                        <DataGridTextColumn IsReadOnly="True" Binding="{Binding VoltageDac.Value}" Width="120">
                                            <DataGridTextColumn.Header>
                                                <TextBlock Text="Напряжение ЦАП, мВ" TextWrapping="Wrap"></TextBlock>
                                            </DataGridTextColumn.Header>
                                        </DataGridTextColumn>
                                       <!--#endregion-->
                                       <!--#region Напряжение TEST, мВ -->
                                        <DataGridTextColumn IsReadOnly="True" Width="120" Binding="{Binding AdcValue.Value}">
                                            <DataGridTextColumn.Header>
                                                <TextBlock Text="Напряжение TEST, мВ" TextWrapping="Wrap"/>
                                            </DataGridTextColumn.Header>
                                        </DataGridTextColumn>
                                            <!--#endregion-->
                                       <!--#region Напряжение RX, мВ -->
                                        <DataGridTextColumn Width="120" IsReadOnly="True" Binding="{Binding VoltageTest.Value}">
                                            <DataGridTextColumn.Header>
                                                <TextBlock Text="Напряжение RX, мВ" TextWrapping="Wrap"/>
                                            </DataGridTextColumn.Header>
                                        </DataGridTextColumn>
                                       <!--#endregion-->                                           
                                       <!--#region Тестовое значение, мВ -->
                                       <DataGridTemplateColumn Width="135">
                                            <DataGridTemplateColumn.Header>
                                                <TextBlock Text="Тестовое значение, мВ" TextWrapping="Wrap"/>
                                            </DataGridTemplateColumn.Header>
                                            <DataGridTemplateColumn.CellTemplate>
                                                    <DataTemplate DataType="add:AnalogOutput">
                                                        <DockPanel>
                                                            <StackPanel Orientation="Horizontal">
                                                                <TextBox  Width="50" HorizontalAlignment="Left">
                                                                    <TextBox.Text>
                                                                        <Binding Path="AmTestValue.WriteValue" UpdateSourceTrigger="PropertyChanged">
                                                                            <Binding.ValidationRules>
                                                                                <DataErrorValidationRule />
                                                                            </Binding.ValidationRules>
                                                                        </Binding>
                                                                    </TextBox.Text>
                                                                </TextBox>
                                                                <Button Width="50" Margin="2,0,2,0" Command="{Binding SetTestSignalCommand}">--></Button>
                                                            </StackPanel>
                                                        </DockPanel>
                                                    </DataTemplate>
                                                </DataGridTemplateColumn.CellTemplate>
                                            </DataGridTemplateColumn>
                                            <!--#endregion-->
                                       <!--#region Тип протокола -->
                                            <DataGridTemplateColumn Header="Тип протокола">
                                                <DataGridTemplateColumn.CellTemplate>
                                                    <DataTemplate DataType="add:AnalogOutput">
                                                        <ComboBox ItemsSource="{StaticResource AnalogProtocols}" SelectedIndex="{Binding Protocol.WriteValue}"></ComboBox>
                                                    </DataTemplate>
                                                </DataGridTemplateColumn.CellTemplate>
                                            </DataGridTemplateColumn>
                                            <!--#endregion-->
                                        <!--#region Активность -->
                                        <DataGridTemplateColumn Width="120">
                                            <DataGridTemplateColumn.Header>
                                                <TextBlock Text="Активность ЦАП" TextWrapping="Wrap"/>
                                            </DataGridTemplateColumn.Header>
                                            <DataGridTemplateColumn.CellTemplate>
                                                <DataTemplate DataType="add:AnalogOutput">
                                                    <ComboBox ItemsSource="{StaticResource On/Off}" SelectedIndex="{Binding Activity.WriteValue, UpdateSourceTrigger=PropertyChanged}">
                                                        <i:Interaction.Triggers>
                                                            <i:EventTrigger EventName="DropDownClosed">
                                                                <i:InvokeCommandAction Command="{Binding SetSettingsCommand}"/>
                                                            </i:EventTrigger>
                                                        </i:Interaction.Triggers>
                                                    </ComboBox>
                                                </DataTemplate>
                                            </DataGridTemplateColumn.CellTemplate>
                                        </DataGridTemplateColumn>
                                        <!--#endregion-->
                                        <!--#region Тип ЦАП -->
                                        <DataGridTemplateColumn Width="120">
                                            <DataGridTemplateColumn.Header>
                                                <TextBlock Text="Тип значения" TextWrapping="Wrap"/>
                                            </DataGridTemplateColumn.Header>
                                            <DataGridTemplateColumn.CellTemplate>
                                                <DataTemplate DataType="add:AnalogOutput">
                                                    <ComboBox ItemsSource="{StaticResource DacSources}" SelectedIndex="{Binding DacType.WriteValue, UpdateSourceTrigger=PropertyChanged}">
                                                        <i:Interaction.Triggers>
                                                            <i:EventTrigger EventName="DropDownClosed">
                                                                <i:InvokeCommandAction Command="{Binding SetSettingsCommand}"/>
                                                            </i:EventTrigger>
                                                        </i:Interaction.Triggers>
                                                    </ComboBox>
                                                </DataTemplate>
                                            </DataGridTemplateColumn.CellTemplate>
                                        </DataGridTemplateColumn>
                                        <!--#endregion-->
                                        <!--#region Единица измерения -->
                                        <DataGridTemplateColumn Width="120">
                                            <DataGridTemplateColumn.Header>
                                                <TextBlock Text="Единица измерения" TextWrapping="Wrap"/>
                                            </DataGridTemplateColumn.Header>
                                            <DataGridTemplateColumn.CellTemplate>
                                                <DataTemplate DataType="add:AnalogOutput">
                                                    <ComboBox ItemsSource="{Binding RelativeSource={RelativeSource AncestorType=Window},Path=DataContext.UnitNames.Data}" 
                                                              DisplayMemberPath="Name" 
                                                              SelectedIndex="{Binding DacEiNdx.WriteValue, UpdateSourceTrigger=PropertyChanged}">
                                                        <i:Interaction.Triggers>
                                                            <i:EventTrigger EventName="DropDownClosed">
                                                                <i:InvokeCommandAction Command="{Binding SetSettingsCommand}"/>
                                                            </i:EventTrigger>
                                                        </i:Interaction.Triggers>
                                                    </ComboBox>
                                                </DataTemplate>
                                            </DataGridTemplateColumn.CellTemplate>
                                        </DataGridTemplateColumn>
                                        <!--#endregion-->
                                        <!--#region Измеряемая переменная -->
                                        <DataGridTemplateColumn Width="120">
                                            <DataGridTemplateColumn.Header>
                                                <TextBlock Text="Измеряемая переменная" TextWrapping="Wrap"/>
                                            </DataGridTemplateColumn.Header>
                                            <DataGridTemplateColumn.CellTemplate>
                                                <DataTemplate DataType="add:AnalogOutput">
                                                    <ComboBox ItemsSource="{Binding RelativeSource={RelativeSource AncestorType=Window},Path=DataContext.TypeAnalogOutVars.Data}" 
                                                              DisplayMemberPath="Name" 
                                                              SelectedIndex="{Binding DacVarNdx.WriteValue, UpdateSourceTrigger=PropertyChanged}">
                                                        <i:Interaction.Triggers>
                                                            <i:EventTrigger EventName="DropDownClosed">
                                                                <i:InvokeCommandAction Command="{Binding SetSettingsCommand}"/>
                                                            </i:EventTrigger>
                                                        </i:Interaction.Triggers>
                                                    </ComboBox>
                                                </DataTemplate>
                                            </DataGridTemplateColumn.CellTemplate>
                                        </DataGridTemplateColumn>
                                        <!--#endregion-->
                                        <!--#region Нижний предел ФВ -->
                                        <DataGridTemplateColumn Width="180">
                                            <DataGridTemplateColumn.Header>
                                                <TextBlock Text="Нижний предел ФВ" TextWrapping="Wrap"/>
                                            </DataGridTemplateColumn.Header>
                                            <DataGridTemplateColumn.CellTemplate>
                                                <DataTemplate DataType="add:AnalogOutput" >
                                                    <DockPanel>
                                                        <StackPanel Orientation="Horizontal">
                                                            <TextBox  Width="50" HorizontalAlignment="Left">
                                                                <TextBox.Text>
                                                                    <Binding Path="DacLowLimit.WriteValue" UpdateSourceTrigger="PropertyChanged">
                                                                        <Binding.ValidationRules>
                                                                            <DataErrorValidationRule />
                                                                        </Binding.ValidationRules>
                                                                    </Binding>
                                                                </TextBox.Text>
                                                            </TextBox>
                                                            <Button Width="50" Margin="2,0,2,0" Command="{Binding SetSettingsCommand}">--></Button>
                                                            <TextBlock Width="50" Style="{StaticResource Common}" Foreground="Black" Text="{Binding DacLowLimit.Value}"></TextBlock>
                                                        </StackPanel>
                                                    </DockPanel>
                                                </DataTemplate>
                                            </DataGridTemplateColumn.CellTemplate>
                                        </DataGridTemplateColumn>
                                        <!--#endregion-->
                                        <!--#region Верхний предел ФВ -->
                                        <DataGridTemplateColumn Width="180">
                                            <DataGridTemplateColumn.Header>
                                                <TextBlock Text="Верхний предел ФВ" TextWrapping="Wrap"/>
                                            </DataGridTemplateColumn.Header>
                                            <DataGridTemplateColumn.CellTemplate>
                                                <DataTemplate DataType="add:AnalogOutput">
                                                    <DockPanel>
                                                        <StackPanel Orientation="Horizontal">
                                                            <TextBox  Width="50" HorizontalAlignment="Left">
                                                                <TextBox.Text>
                                                                    <Binding Path="DacHighLimit.WriteValue" UpdateSourceTrigger="PropertyChanged">
                                                                        <Binding.ValidationRules>
                                                                            <DataErrorValidationRule />
                                                                        </Binding.ValidationRules>
                                                                    </Binding>
                                                                </TextBox.Text>
                                                            </TextBox>
                                                            <Button Width="50" Margin="2,0,2,0" Command="{Binding SetSettingsCommand}">--></Button>
                                                            <TextBlock Width="50" Style="{StaticResource Common}" Foreground="Black" Text="{Binding DacHighLimit.Value}"></TextBlock>
                                                        </StackPanel>
                                                    </DockPanel>
                                                </DataTemplate>
                                            </DataGridTemplateColumn.CellTemplate>
                                        </DataGridTemplateColumn>
                                        <!--#endregion-->
                                    </DataGrid.Columns>
                                    </DataGrid>
                                </GroupBox>
                                <!--#endregion-->
                            </DockPanel>                        
                    </TabItem>
                    <!--#endregion-->
                    <!--#region События -->
                    <TabItem Header="СОБЫТИЯ">
                        <DataGrid ItemsSource="{Binding Events.EventDevices}" 
                                  AutoGenerateColumns="False" 
                                  CanUserAddRows="False">
                            <DataGrid.Columns>
                                <!--#region ID -->
                                <DataGridTextColumn Header="Id" Binding="{Binding Id}" IsReadOnly="True"/>
                                <!--#endregion-->
                                <DataGridTextColumn Header="Номер" Binding="{Binding Num, StringFormat=d4}"></DataGridTextColumn>
                                <!--#region Заголовок -->
                                <DataGridTextColumn Header="Заголовок" Binding="{Binding Title}"/>
                                <!--#endregion-->
                                <!--#region Описание события -->
                                <DataGridTextColumn Header="Описание события" Binding="{Binding Description}" />
                                <!--#endregion-->
                                <!--#region Активный фон -->
                                <DataGridTemplateColumn Width="120">
                                    <DataGridTemplateColumn.Header>
                                        <TextBlock Text="Активный фон"
                                                   TextWrapping="Wrap"/>
                                    </DataGridTemplateColumn.Header>
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <wpftool:ColorPicker SelectedColor="{Binding ActiveColor, UpdateSourceTrigger=LostFocus}"/>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>
                                <!--#endregion-->
                                <!--#region Неактивный фон -->
                                <DataGridTemplateColumn Width="120">
                                    <DataGridTemplateColumn.Header>
                                        <TextBlock Text="Неактивный фон"
                                                   TextWrapping="Wrap"/>
                                    </DataGridTemplateColumn.Header>
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <wpftool:ColorPicker SelectedColor="{Binding NotActiveColor, UpdateSourceTrigger=LostFocus}"/>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>
                                <DataGridTemplateColumn Header="Тип" Width="120">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <ComboBox ItemsSource="{StaticResource EventTypes}" SelectedIndex="{Binding Type, UpdateSourceTrigger=PropertyChanged}"/>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>
                                <DataGridCheckBoxColumn Binding="{Binding IsActive, UpdateSourceTrigger=PropertyChanged}"/>
                                <!--#endregion-->
                            </DataGrid.Columns>
                        </DataGrid>
                    </TabItem>
                    <!--#endregion-->
                    <!--#region Управление пользователями -->
                    <TabItem Header="ПОЛЬЗОВАТЕЛИ">
                        <DataGrid  ItemsSource="{Binding Users.Data}">                            
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="Логин" Binding="{Binding Login}"/>
                                <DataGridTextColumn Header="Имя" Binding="{Binding Path=Name}"></DataGridTextColumn>
                                <DataGridTextColumn Header="Фамилия" Binding="{Binding Path=Somename}"></DataGridTextColumn>
                                <DataGridComboBoxColumn Header="Уровень доступа" ItemsSource="{StaticResource users}" SelectedItemBinding="{Binding Path=Level}" ></DataGridComboBoxColumn>
                                <DataGridTextColumn Header="Пароль" Binding="{Binding Password}"/>
                            </DataGrid.Columns>
                        </DataGrid>
                    </TabItem>
                    <!--#endregion-->
                    <!--#region Перечисления -->
                    <TabItem Header="ПЕРЕЧИСЛЕНИЯ">
                        <TabItem.Resources>
                            <!--#region Общий шаблон для таблички -->
                            <ControlTemplate x:Key="Enums">
                                <GroupBox Header="{Binding RelativeSource={RelativeSource Mode=TemplatedParent}, Path=Tag}">
                                    <DataGrid ItemsSource="{Binding RelativeSource={RelativeSource Mode=TemplatedParent}, Path=DataContext}"   >
                                        <DataGrid.Columns>
                                            <DataGridTextColumn  Header="Id" Binding="{Binding Id}" IsReadOnly="True"></DataGridTextColumn>
                                            <DataGridTextColumn Header="Name" Binding="{Binding Name}"></DataGridTextColumn>
                                        </DataGrid.Columns>
                                    </DataGrid>
                                </GroupBox>
                                
                            </ControlTemplate>
                            <!--#endregion-->
                        </TabItem.Resources>
                        <WrapPanel>
                            <!--#region Названия измерительных процессов -->
                            <DataGrid Template="{StaticResource Enums}" DataContext="{Binding MeasProcessNames.Data}" Tag="Названия измерительных процессов"></DataGrid>                            
                            <!--#endregion-->
                            <!--#region Единицы измерения -->
                            <DataGrid Template="{StaticResource Enums}" DataContext="{Binding UnitNames.Data}" Tag="Единицы измерения"></DataGrid>
                            <!--#endregion-->
                            <!--#region Тип переменной для аналогового выхода -->
                            <DataGrid Template="{StaticResource Enums}" DataContext="{Binding TypeAnalogOutVars.Data}" Tag="Тип переменной для аналогового выхода"></DataGrid>
                            <!--#endregion-->
                            <DataGrid Template="{StaticResource Enums}" DataContext="{Binding StandNames.Data}" Tag="Названия стандартизаций"></DataGrid>
                        </WrapPanel>
                        
                    </TabItem>
                    <!--#endregion-->
                    <!--#region Параметры -->
                    <TabItem Header="ПАРАМЕТРЫ">
                        <TabItem.Resources>
                            <add:ParamList x:Key="paramsList"/>
                        </TabItem.Resources>
                        <DataGrid ItemsSource="{Binding Source={StaticResource paramsList}, Path=ParameterList}">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="Id" Binding="{Binding Id}"></DataGridTextColumn>
                                <DataGridTextColumn Header="Описание" Binding="{Binding Description}"></DataGridTextColumn>
                                <DataGridTextColumn Header="Мин. величина" Binding="{Binding MinValue}"></DataGridTextColumn>
                                <DataGridTextColumn Header="Макс. величина" Binding="{Binding MaxValue}"></DataGridTextColumn>                               
                            </DataGrid.Columns>
                        </DataGrid>
                    </TabItem>
                    <!--#endregion-->
                </TabControl>
            </TabItem>
            <!--#endregion-->
            <!--#region События -->
            <TabItem Header="СОБЫТИЯ">
                <TabControl TabStripPlacement="Top">
                    <TabItem Header="ВСЕ СОБЫТИЯ">
                        <Grid>
                            <Grid.Resources>
                                <CollectionViewSource x:Key="EventsCollection" Source="{Binding HistoryEventItems}"/>
                            </Grid.Resources>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="40"/>
                                <RowDefinition/>
                            </Grid.RowDefinitions>
                            <!--#region Панель фильтров -->
                            <Grid Grid.Row="0">
                                <UniformGrid Columns="5">
                                    <uc:DateTimeParameter Description="Начальная точка событий"
                                              DateTimeWidth="200"
                                              Margin="2"
                                              DateTime="{Binding StartPointHistoryEvent, UpdateSourceTrigger=PropertyChanged, Mode=TwoWay}"/>
                                    <uc:DateTimeParameter Description="Конечная точка событий"
                                              DateTimeWidth="200"                                              
                                              Margin="2"
                                              DateTime="{Binding EndPointHistoryEvent, UpdateSourceTrigger=PropertyChanged, Mode=TwoWay}"/>
                                    <Button Margin="2"
                                            VerticalContentAlignment="Center"
                                            Command="{Binding ShowEventsCommand}"
                                           >
                                        <Button.Content>
                                            <StackPanel Orientation="Horizontal">
                                                <fa:ImageAwesome Width="20" 
                                                                 Icon="Refresh" 
                                                                 Foreground="AliceBlue" 
                                                                 Spin="{Binding HistoryItemDownloading}" 
                                                                 Visibility="{Binding HistoryItemDownloading, Converter={StaticResource BooleanToVisibilityConverter}}"/>
                                                <TextBlock Text="Показать" VerticalAlignment="Center"
                                                           HorizontalAlignment="Center"/>
                                            </StackPanel>
                                        </Button.Content>
                                    </Button>
                                    <Border Margin="2" Style="{StaticResource BorderLight}">
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition/>
                                                <ColumnDefinition Width="0.1*"/>                                                
                                            </Grid.ColumnDefinitions>
                                            <TextBox HorizontalContentAlignment="Left"
                                                     VerticalContentAlignment="Center"
                                                     Text="{Binding EventFilterText, UpdateSourceTrigger=PropertyChanged}"/>
                                            <fa:ImageAwesome Grid.Column="1" Icon="Search" Width="20" Foreground="AliceBlue"/>
                                        </Grid>
                                    </Border>                                    
                                </UniformGrid>
                                
                            </Grid>                            
                            <!--#endregion-->
                            <!--#region Таблица всех событий -->
                            <DataGrid Grid.Row="1" 
                                      IsReadOnly="True" 
                                      AutoGenerateColumns="False" 
                                      ItemsSource="{Binding SelectedEventItems}" 
                                      VirtualizingPanel.VirtualizationMode="Recycling"
                                      CanUserAddRows="False" 
                                      CanUserDeleteRows="False">
                                <DataGrid.ItemsPanel>
                                    <ItemsPanelTemplate>
                                        <VirtualizingStackPanel/>
                                    </ItemsPanelTemplate>
                                </DataGrid.ItemsPanel>
                                <DataGrid.RowStyle>
                                    <Style TargetType="DataGridRow" BasedOn="{StaticResource EventRowStyle}"/>
                                </DataGrid.RowStyle>
                                <DataGrid.Columns>
                                    <DataGridTextColumn Header="Время возникновения ошибки" Binding="{Binding EventTime, StringFormat=F,ConverterCulture=ru-RU}"/>
                                    <DataGridTextColumn Header="Пользователь" Binding="{Binding UserName}"/>
                                    <DataGridTextColumn Header="Код события" Binding="{Binding Event.Num, StringFormat=d4}"/>
                                    <DataGridTextColumn Header="Сообщение" Binding="{Binding Event.Title}"/>
                                </DataGrid.Columns>
                            </DataGrid>
                            <!--#endregion-->
                        </Grid>
                    </TabItem>
                    <TabItem Header="ОШИБКИ">
                        <ListView ItemsSource="{Binding Events.EventDevices}">
                            <ListView.ItemContainerStyle>
                                <Style TargetType="ListViewItem">
                                    <Setter Property="Background" Value="{Binding ActiveBrush}"/>
                                    <Setter Property="Visibility" Value="{Binding IsActive, Converter={StaticResource VisibleConverter}}"/>
                                </Style>
                            </ListView.ItemContainerStyle>
                            <ListView.View>
                                <GridView>
                                    <GridViewColumn Header="Номер" DisplayMemberBinding="{Binding Num, StringFormat=d4}"/>
                                    <GridViewColumn Header="Сообщение" DisplayMemberBinding="{Binding Title}"/>
                                    <GridViewColumn Header="Время" DisplayMemberBinding="{Binding LastExecDate}"/>
                                    
                                </GridView>
                            </ListView.View>
                        </ListView>
                    </TabItem>
                </TabControl>
                
            </TabItem>
            
            <!--#endregion-->
        </TabControl>
        <Grid.RowDefinitions>
            <RowDefinition Height="0.1*" ></RowDefinition>
            <RowDefinition ></RowDefinition>
        </Grid.RowDefinitions>
        <!--#endregion-->
    </Grid>
    <!--#endregion-->
</Window>
